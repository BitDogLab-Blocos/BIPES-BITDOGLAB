<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="google" value="notranslate">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>BitdogLab - Aprenda Programa√ß√£o de Forma Divertida</title>

  <!-- Favicons (cache-busting with v=forced2024) -->
  <link rel="icon" type="image/x-icon" href="/bitdog-favicon.ico?v=forced2024">
  <link rel="shortcut icon" type="image/x-icon" href="/bitdog-favicon.ico?v=forced2024">
  <link rel="icon" type="image/png" sizes="32x32" href="/bitdog-icon.png?v=forced2024">
  <link rel="icon" type="image/png" sizes="16x16" href="/bitdog-icon.png?v=forced2024">
  <link rel="apple-touch-icon" sizes="180x180" href="/bitdog-icon.png?v=forced2024">
  <link rel="mask-icon" href="/media/icon/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#fff">

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json"></link>
  <script src="core/manup.js"></script>

<script>
// Legacy cookie utilities (unused)
function setCookie(cname, cvalue, cpassword_value, exdays) {
  var d = new Date();
  d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
  var expires = "expires="+d.toUTCString();
  document.cookie = cname + "=" + cvalue + "&"+ "last_pass="+ cpassword_value + ";" + expires + ";path=/";
}

function getCookie(cname) {
  var name = cname + "=";
  var ca = document.cookie.split(';');
  console.log(ca)
  for(var i = 0; i < ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

function checkCookie() {
  var cookies = getCookie("last_ip");
  if (cookies != "") {
    var cookies_ = cookies.split('&')
    document.getElementById('url').value = cookies_[0]
    document.getElementById('password').value = cookies_[1].substring("last_pass=".length, cookies_[0].length)
  }
}
</script>
  <link rel="stylesheet" href="style.css?ver=0.2.3.1125">
  <link rel="stylesheet" href="core/libs.css">
  <!-- Blockly core -->
  <script src="core/blockly_compressed.js?ver=0.2.1.8260042"></script>
  <script src="core/python_compressed.js?ver=0.2.3.9292231"></script>

  <!-- BitdogLab core modules -->
  <script src="core/storage.js"></script>
  <script src="core/utils.js?ver=0.2.3.20251001v2"></script>
  <script src="core/bitdoglab_config.js?ver=0.2.3.20251001v4"></script>
  <script src="core/code.js?ver=0.2.3.20251001v4"></script>
  <script src="core/webserial.js?ver=0.2.3.20251001v2"></script>
  <script src="core/channel.js?ver=0.2.3.20251001v2"></script>
  <script src="core/ui.js?ver=0.2.3.1125"></script>
  <script src="core/FileSaver.js"></script>


  <!-- Custom BitdogLab blocks -->
  <script src="core/block_definitions.js?ver=20250108v5"></script>
  <script src="core/generator_stubs.js?ver=20250108v5"></script>

  <!-- Terminal (xterm.js) -->
  <script src="core/xterm.js?ver=4.13.0"></script>

  <!-- Code editor (CodeMirror) -->
  <script src="core/codemirror/codemirror.js"></script>
  <script src="core/codemirror/mode/python/python.js"></script>

  <!-- Unregister service workers for cache clearing -->
  <script type="module">
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script>

</head>
<body>

  <!-- Welcome splash modal -->
  <div id="welcome-message" style="position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(75,46,131,0.95); z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; transition:opacity 1s ease;">
    <div style="background-color:white; padding:40px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.3); max-width:80%; position:relative;">
      <h1 style="font-family:'Comic Sans MS', cursive; color:#4b2e83; margin-top:0;">Bem-vindo √† BitdogLab!</h1>
      <p style="font-size:18px; line-height:1.6; color:#333; margin:20px 0;">Aqui voc√™ vai aprender programa√ß√£o de forma divertida e criativa! Explore os blocos, crie seus pr√≥prios projetos e divirta-se programando.</p>
      <button id="startAdventureBtn" style="background-color:#4b2e83; color:white; border:none; padding:12px 25px; font-size:18px; border-radius:10px; cursor:pointer; transition:all 0.3s ease; animation:bounce 2s infinite; font-family:'Comic Sans MS', cursive;">Come√ßar a Aventura</button>
    </div>
  </div>

  <!-- Partnership notice modal -->
  <div id="partnership-notice" style="position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.8); z-index:9998; display:none; justify-content:center; align-items:center; text-align:center; transition:opacity 1s ease; opacity:0;">
    <div style="background-color:white; padding:30px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.3); max-width:600px; border-left:8px solid #85754d;">
      <h2 style="color:#4b2e83; margin-top:0; font-family:'Comic Sans MS', cursive;">AVISO IMPORTANTE</h2>
      <p style="font-size:16px; line-height:1.5; margin:15px 0; text-align:left;">
        A BitdogLab √© uma parceria oficial do projeto BIPES (Block Based Integrated Platform for Embedded Systems).
        Essa iniciativa visa democratizar o acesso √† programa√ß√£o e rob√≥tica para crian√ßas e jovens no Brasil.
      </p>
      <p style="font-size:16px; line-height:1.5; margin:15px 0; text-align:left;">
        Atrav√©s desta parceria, fornecemos uma plataforma educacional completa com hardware (placa BitdogLab baseada no Raspberry Pi Pico)
        e software (ambiente de programa√ß√£o por blocos), tornando o aprendizado de programa√ß√£o mais acess√≠vel e divertido.
      </p>
      <button id="closePartnershipBtn" style="background-color:#85754d; color:white; border:none; padding:10px 20px; font-size:16px; border-radius:8px; cursor:pointer; transition:all 0.2s ease; margin-top:10px;">Entendi!</button>
    </div>
  </div>

  <!-- Step-by-step tutorial panel -->
  <div id="tutorial-steps" style="position:fixed; bottom:20px; right:20px; width:350px; background-color:white; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.2); z-index:9990; overflow:hidden; display:none; font-family:'Comic Sans MS', cursive;">
    <div style="background-color:#4b2e83; color:white; padding:10px 15px; display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0;">Como Come√ßar</h3>
      <button id="closeTutorialBtn" style="background:none; border:none; color:white; font-size:18px; cursor:pointer;">&times;</button>
    </div>
    
    <div class="tutorial-content" style="padding:15px;">
      <div class="tutorial-step" style="margin-bottom:20px; display:flex; align-items:center;">
        <div style="width:30px; height:30px; background-color:#4b2e83; color:white; border-radius:50%; display:flex; justify-content:center; align-items:center; margin-right:10px; flex-shrink:0;">1</div>
        <div>
          <h4 style="margin:0 0 5px 0; color:#4b2e83;">Escolha blocos na paleta</h4>
          <p style="margin:0; font-size:14px; line-height:1.4;">Arraste blocos da paleta √† esquerda para a √°rea de trabalho.</p>
        </div>
      </div>
      
      <div class="tutorial-step" style="margin-bottom:20px; display:flex; align-items:center;">
        <div style="width:30px; height:30px; background-color:#4b2e83; color:white; border-radius:50%; display:flex; justify-content:center; align-items:center; margin-right:10px; flex-shrink:0;">2</div>
        <div>
          <h4 style="margin:0 0 5px 0; color:#4b2e83;">Instale o MicroPython</h4>
          <p style="margin:0; font-size:14px; line-height:1.4;">Antes de come√ßar, instale o MicroPython na sua placa. Voc√™ pode fazer isso via modo BOOTSEL <a href="https://micropython.org/download/" target="_blank" style="color:#4b2e83; text-decoration:underline;">clicando aqui</a>.</p>
        </div>
      </div>
      
      <div class="tutorial-step" style="margin-bottom:20px; display:flex; align-items:center;">
        <div style="width:30px; height:30px; background-color:#4b2e83; color:white; border-radius:50%; display:flex; justify-content:center; align-items:center; margin-right:10px; flex-shrink:0;">3</div>
        <div>
          <h4 style="margin:0 0 5px 0; color:#4b2e83;">Conecte sua placa BitdogLab</h4>
          <p style="margin:0; font-size:14px; line-height:1.4;">Clique no bot√£o de dispositivo e conecte sua placa via USB.</p>
        </div>
      </div>
      
      <div class="tutorial-step" style="margin-bottom:20px; display:flex; align-items:center;">
        <div style="width:30px; height:30px; background-color:#4b2e83; color:white; border-radius:50%; display:flex; justify-content:center; align-items:center; margin-right:10px; flex-shrink:0;">4</div>
        <div>
          <h4 style="margin:0 0 5px 0; color:#4b2e83;">Crie seu c√≥digo</h4>
          <p style="margin:0; font-size:14px; line-height:1.4;">Monte os blocos como um quebra-cabe√ßa para criar seu programa.</p>
        </div>
      </div>
      
      <div class="tutorial-step" style="margin-bottom:20px; display:flex; align-items:center;">
        <div style="width:30px; height:30px; background-color:#4b2e83; color:white; border-radius:50%; display:flex; justify-content:center; align-items:center; margin-right:10px; flex-shrink:0;">5</div>
        <div>
          <h4 style="margin:0 0 5px 0; color:#4b2e83;">Execute seu programa</h4>
          <p style="margin:0; font-size:14px; line-height:1.4;">Clique no bot√£o de execu√ß√£o para enviar seu c√≥digo para a placa.</p>
        </div>
      </div>
      
      <div class="tutorial-step" style="margin-bottom:0; display:flex; align-items:center;">
        <div style="width:30px; height:30px; background-color:#4b2e83; color:white; border-radius:50%; display:flex; justify-content:center; align-items:center; margin-right:10px; flex-shrink:0;">6</div>
        <div>
          <h4 style="margin:0 0 5px 0; color:#4b2e83;">Veja o resultado</h4>
          <p style="margin:0; font-size:14px; line-height:1.4;">Observe o console para ver a sa√≠da do seu programa e como a placa BitdogLab est√° respondendo.</p>
        </div>
      </div>
    </div>
    
    <div id="additional-steps" style="display:none; padding:15px; border-top:1px solid #e0e0e0; background-color:#fafafa;">
      <h4 style="color:#4b2e83; margin-top:0; font-weight:bold;">Vamos come√ßar a programar:</h4>
      <ol style="padding-left:20px; margin-bottom:10px;">
        <li style="margin-bottom:8px;"><strong>Selecione um exemplo:</strong> Escolha um exemplo da biblioteca (Menu Exemplos > B√°sicos)</li>
        <li style="margin-bottom:8px;"><strong>Conecte sua placa:</strong> Verifique se a conex√£o est√° est√°vel (LED verde indica conex√£o ativa)</li>
        <li style="margin-bottom:8px;"><strong>Montagem dos blocos:</strong> Use os blocos de controle, entradas e sa√≠das para criar seu algoritmo</li>
        <li style="margin-bottom:8px;"><strong>Experimente sensores:</strong> Adicione blocos de leitura de sensores e controle de LEDs</li>
        <li style="margin-bottom:0;"><strong>Salve seu projeto:</strong> Clique no bot√£o de salvamento frequentemente para n√£o perder seu trabalho</li>
      </ol>
    </div>
    
    <div style="padding:10px 15px; background-color:#f0f0f0; text-align:right;">
      <button id="startCodingBtn" style="background-color:#85754d; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; transition:all 0.2s ease;">Vamos Programar!</button>
    </div>
  </div>

  <script>
    // Bounce animation keyframes for buttons
    document.head.insertAdjacentHTML('beforeend', '<style>@keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-20px)}60%{transform:translateY(-10px)}}</style>');

    // Welcome flow: splash -> partnership -> tutorial
    window.addEventListener('DOMContentLoaded', function() {
      var startBtn = document.getElementById('startAdventureBtn');
      var welcomeMsg = document.getElementById('welcome-message');
      var partnershipNotice = document.getElementById('partnership-notice');
      var closePartnershipBtn = document.getElementById('closePartnershipBtn');
      var tutorialContainer = document.getElementById('tutorial-steps');

      welcomeMsg.style.display = 'flex';

      // Welcome -> Partnership transition
      if (startBtn && welcomeMsg && partnershipNotice) {
        startBtn.addEventListener('click', function() {
          welcomeMsg.style.opacity = '0';
          setTimeout(function() {
            welcomeMsg.style.display = 'none';
            partnershipNotice.style.display = 'flex';
            partnershipNotice.style.opacity = '0';
            void partnershipNotice.offsetWidth; // Force reflow
            setTimeout(function() {
              partnershipNotice.style.opacity = '1';
            }, 50);
          }, 1000);
        });
      }

      // Partnership -> Tutorial transition
      if (closePartnershipBtn && partnershipNotice && tutorialContainer) {
        closePartnershipBtn.addEventListener('click', function() {
          partnershipNotice.style.opacity = '0';
          setTimeout(function() {
            partnershipNotice.style.display = 'none';
            tutorialContainer.style.display = 'block';
            localStorage.setItem('bitdoglab_visited', 'true'); // Mark first visit
          }, 1000);
        });
      }

      // Toggle additional tutorial steps
      var startCodingBtn = document.getElementById('startCodingBtn');
      var additionalSteps = document.getElementById('additional-steps');

      if (startCodingBtn && additionalSteps) {
        startCodingBtn.addEventListener('click', function() {
          if (additionalSteps.style.display === 'block') {
            additionalSteps.style.display = 'none';
          } else {
            additionalSteps.style.display = 'block';
            additionalSteps.style.backgroundColor = '#f5f0d5'; // Highlight effect
            setTimeout(function() {
              additionalSteps.style.backgroundColor = '#fafafa';
            }, 1000);
            additionalSteps.scrollIntoView({behavior: 'smooth'});
            startCodingBtn.style.animation = 'bounce 0.5s';
            setTimeout(function() { startCodingBtn.style.animation = ''; }, 500);
          }
        });
      }
    });
  </script>
  
  <script>
    // Load Blockly toolbox from XML
    window.addEventListener('load', function() {
      try {
        if (typeof Blockly !== 'undefined' && Blockly.getMainWorkspace()) {
          var request = new XMLHttpRequest();
          request.open('GET', 'toolbox/default.xml', true);
          request.onreadystatechange = function() {
            if (request.readyState === 4 && request.status === 200) {
              var toolboxXml = Blockly.Xml.textToDom(request.responseText);
              Blockly.getMainWorkspace().updateToolbox(toolboxXml);
              console.log('Toolbox loaded');
              Blockly.svgResize(Blockly.getMainWorkspace());
            }
          };
          request.send(null);
        }
      } catch(e) {
        console.error('Toolbox load error:', e);
      }
    });

    // Tutorial panel close handlers
    window.addEventListener('DOMContentLoaded', function() {
      var closeTutorialBtn = document.getElementById('closeTutorialBtn');
      var startCodingBtn = document.getElementById('startCodingBtn');
      var tutorialContainer = document.getElementById('tutorial-steps');

      if (closeTutorialBtn && tutorialContainer) {
        closeTutorialBtn.addEventListener('click', function() {
          tutorialContainer.style.display = 'none';
        });
      }

      if (startCodingBtn && tutorialContainer) {
        startCodingBtn.addEventListener('click', function() {
          tutorialContainer.style.display = 'none';
        });
      }
    });
  </script>

  <div class="top-menu">

    <div class="logo" style="display: flex; align-items: center; gap: 10px;">BitdogLab <img src="media/bipes.jpeg" alt="BIPES Logo" style="height: 2rem; border-radius: 5px; margin-left: 10px;"></div>
      <div class="tabs">
        <div id="tab_blocks" class="tabon">Blocos</div>
        <div id="tab_console" class="taboff">Mensagens</div>
        <div id="tab_device" class="taboff">Dispositivo</div>
        <div id="tab_files" class="taboff" style="display:none;">Arquivos</div>
        <div id="tab_programs" class="taboff" style="display:none;">Programas</div>
        <div id="tab_iot" class="taboff" style="display:none;">Internet</div>
        <div id="tab_mqtt" class="taboff" style="display:none;" onclick='document.getElementById("easymqtt_iframe").contentWindow.startEasyMQTT(window.easyMQTT_session);'>Mensagens</div>
        <div id="tab_databoard" class="taboff" style="display:none;">Dados</div>
      </div>
      <button id="toolbarButton" class="notext icon medium" title="Ferramentas"></button>
      <div class="toolbar">
      <div id="channel_connect">
        <button class="icon" id="channelButton" title="Escolher canal de conex√£o"></button>
        <button class="icon" id="connectButton" title="Conectar/Desconectar"></button>
      </div>
      <div class="icon" id="deviceSelect">
        <select id="device_selector">
          <option value="RPI_Pico">BitdogLab</option>
        </select>
        <button id="runButton" class="notext primary icon" title="Executar Programa"></button>
      </div>

        <button id="linkButton" class="notext icon" title="Compartilhar" style="display: none;"></button>

        <button id="saveButton" class="notext icon" title="Salvar"></button>

        <label id="loadButton" for="loadXML"  class="notext button icon" title="..."></label>
        <input name="XML" id="loadXML" type="file" accept=".xml" required="">
        <button id="notificationButton" class="notext icon" title="..."></button>
        <button id="forumButton" class="notext icon" title="..."></button>
        <button id="accountButton" class="notext icon" title="..."></button>
      </div>
    </div>

  <div class='channel-panel'>
    <div>
      <button class='icon' id="serialButton">Serial</button>
      <label for="resetBoard" class="checkswitch">
        Reset on connect
        <input type="checkbox" id="resetBoard" class="checkswitch" value="off">
        <span></span>
      </label>
    </div>
  </div>

  <div id="content_blocks" class="content"></div>
  <div id="content_console" class="content">
       
    <tr height="25%" id="termTR">
     <td>
        <div style="display:inline-block; vertical-align:top; ">
    <div id="term" class="xterm">
            </div>
        </div>
     </td>
     <td>
        <div id="file-boxes" >

            <button onclick="Tool.runPython(); return false;">‚ñ∂Ô∏è Rodar programa em blocos</button>
      <br>
      <br>
            <button onclick="Tool.stopPython(); return false;">‚èπÔ∏è Parar programa</button>
            <button onclick="Tool.softReset(); return false;">üîÑ Reiniciar dispositivo</button>
      <br>
      <br>
      <button onclick="term.write('\x1bc');  ">üßπ Limpar tela</button>
    </div>

    </td>
   </tr>
</div>

  <div id="content_programs" class="content">
    <center>
    <iframe src="shared.html" width="100%" height="500" frameBorder="0"></iframe>
    </center>
  </div>

  <div id="content_device" class="content">
    <center>
      <label id="device_title"><b>BitdogLab (Raspberry Pi Pico)</b><br></label>
    <br>
    <img id="device_img" src="devinfo/media/RPI_Pico.svg" style="max-width:90%; height:auto;">
    <br>

    <label id="device_desc">
	      <BR><BR><h3>Especifica√ß√µes do BitdogLab</h3>
        <ul style="text-align:left; max-width:600px; margin:0 auto; line-height:1.6;">
          <li><b>Microcontrolador:</b> RP2040 dual-core Arm Cortex M0+ processor, com clock flex√≠vel at√© 133 MHz</li>
          <li><b>Mem√≥ria:</b> 264KB de SRAM e 2MB de mem√≥ria Flash</li>
          <li><b>GPIO:</b> 26 pinos multifun√ß√£o</li>
          <li><b>Interface:</b> 2 x UART, 2 x SPI controllers, 2 x I2C controllers, 16 x PWM channels</li>
          <li><b>Conectividade:</b> USB 1.1 com suporte a host e dispositivo</li>
          <li><b>Programa√ß√£o:</b> MicroPython e C/C++</li>
        </ul>
    </label>

    </center>
  </div>

  <div id="content_files" class="content">
  <div id="file-boxes">
  <div id="file-header">
    <span>File manager</span>
    <label id="putFileButton" for="put-file-select"  class="noteaxt button icon" title="Upload script to device"></label>
    <input name="PutFileList" id="put-file-select" type="file" accept=".md,.py" required="">
  </div>
  <div id="file-status">...</div>
  <span id='filesPanel'>
  <details open>
  <summary>
  <h2>On device</h2>
  <button value="List Files" id="refreshFilesList" class="notext button icon" title="Refresh device file list" onclick="Files.listFiles();" /></button>
  </summary>
  <span id='fileList'>...</span>
  </details>
  <details open>
  <summary><h2>Blocks to code</h2></summary>
  <span id='blocks2Code'>
    <div id='blocks2codePython' title="Code generated by the blocks with Blockly."></div>
    <div id='blocks2codeXML' title="BIPES files with all blocks and configuration, like freeboard workspace.">workspace.bipes.xml<span>internal</span></div>
  </span></details>
  <details>
  <summary><h2>Templates</h2></summary>
  <span id='fileTemplate'>
    <div onclick="Tool.getText('main.py');">main.py</div>
    <div onclick="Tool.getText('ssd1306.py');">ssd1306.py</div>
  </span>
  </details>
  </div>


  <div>

  <div id="file_save_as" class="py">
  <input type=text id=content_file_name placeholder="Filename">
  <button id="editor2DeviceButton" class="button icon text" onclick="Files.files_save_as();">Save</button>
  <button id="generated2DeviceButton" class="button icon text" onclick="Files.file_save_as.className = 'py';  Files.files_save_as ();">Save a copy</button>
  <button id="updateXMLButton"  class="button icon text" onclick="Files.editedXML2Workspace();">Push to workspace</button>
  </div>
  <textarea id="content_file_code" wrap="off"></textarea>

  <link rel="stylesheet" href="core/codemirror/codemirror.css">
  </div>
</div>

  <div id="content_iot" class="content">
     <iframe id="content_iot" src="freeboard/index.html" width="100%" height="100%" frameBorder="0"></iframe>
  </div>

<div id="content_mqtt" class="content" style="padding: 0;">
  <iframe id="easymqtt_iframe" src="../easymqtt/index.html" width="100%" height="100%" frameBorder="0"></iframe>
</div>

<div id="content_databoard" class="content" style="padding: 0;">
  <iframe id="databoard_iframe" src="../databoard/index.html" width="100%" height="100%" frameBorder="0"></iframe>
</div>

</div>
<div class='progress-bar'></div>
<div class="notify"></div>
<div class="notify-panel"></div>
<div class="account-panel">
  <span>
    <span id="account_header"><span id="hello_text"></span>, <span id="account_user" role="textbox" contenteditable id="user_text">User</span>!</span>
    <details open>
    <summary>
    <h2 id="projects_header">Projects</h2>
    <button value="New Project" id="newProjectButton" class="notext button icon" title="Create new project" onclick="/*UI ['workspace'].newProject();*/" /></button>
    </summary>
    <span id='ProjectList'></span>
    </details>
  </span>
  <details open>
  <summary>
  <h2 id="settings_header">Settings</h2>
  </summary>
  <span class="icon" id="languageIcon">
  <select id="languageMenu"></select>
  </span>
  </details>
</div>

<script>
// Initialize Blockly workspace
Code.init ();

// Communication channels (WebSerial)
var Channel = {};
Channel ['webserial'] = new webserial ();
Channel ['mux'] = new mux ();

// Terminal (xterm.js)
var terminal = new Terminal ();
term.init('#term');

// File manager
var Files = new files ('#fileList');

// UI components
var UI = {};
UI ['responsive'] = new responsive ();
UI ['notify'] = new notify ();
UI ['progress'] = new progress ();
UI ['account'] = new account ('#accountButton','.account-panel');
UI ['notify-panel'] = new panel ('#notificationButton','.notify-panel');
UI ['channel-panel'] = new channelPanel ('#channelButton','.channel-panel');
UI ['toolbar'] = new panel ('#toolbarButton','.toolbar');
UI ['workspace'] = new workspace ();

// Clear queue from previous session
Tool.clearQueue ();

window.onload = function() {
	checkCookie();

	// i18n: Auto-detect browser language
	var userLang = navigator.language || navigator.userLanguage + " ";
	var addMsg = "";

	// Check URL params for language override
	const queryString = window.location.search;
	const urlParams = new URLSearchParams(queryString);
	pLang = urlParams.get('lang');

	if (!userLang) userLang = 'en';
	if (!pLang) pLang = 'en';

	// Keyboard shortcuts (Ctrl+Shift+...)
	shortcut.add("Ctrl+Shift+L", function() {
		Tool.exportScreenshot(); // Screenshot
	});

	shortcut.add("Ctrl+Shift+E", function() {
		Code.handleLink('console', 1); // Run + switch to console
		Tool.runPython();
	});

	shortcut.add("Ctrl+Shift+R", function() {
		Tool.runPython(); // Run program
	});

	shortcut.add("Ctrl+Shift+S", function() {
		Tool.stopPython(); // Stop program
	});
};

</script>

</body>
</html>
